---

# This role configures the dynamic inventory config file

- assert:
    that:
    - exp_base is defined

- name: Assert that only a single host type is defined in experiments
  assert:
    that:
    - host_types.keys() | length | int == 1

- name: Template dynamic inventory config file
  # we do this because we want to have the project id as an inventory filter (such that only ec2 instances with a corresponding tag are visible)
  template:
    src: resources/inventory/euler.yml.j2
    dest: inventory/euler.yml
    mode: 0755
  vars:
    prj_clear: False # controls whether to also filter for the suite or not (for a clear we want to include all instances of the project independent of the suite)
    is_ansible_controller: False
    number_of_experiments: "{{ host_types | dict2items | map(attribute='value') | first | length | int }}"