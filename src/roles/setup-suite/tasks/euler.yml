---

# This role is always executed an ensures that the task spooler is installed and the code repository is downloaded.

- debug:
    msg: "-> setup suite"
  tags: [print_action]

#- name: Overwrite euler-specific variables
#  set_fact:
#    remote:
#      dir: "/cluster/home/{{ euler_user }}"
#      results_dir: "/cluster/home/{{ euler_user }}/results"
#
#- name: Debug check
#  debug:
#    msg: "{{ exp_code_dir }}"


# Use ssh-agent to get code from Git Remote Repository:
#
# 1. Configure ~/.ssh/config:  (add to file and replace the key for example with aws_ppl.pem)
#    ```
#    Host ec2*
#    IdentifyFile ~/.ssh/{{ ssh_key_name }}
#    ForwardAgent yes
#    ```
#
# 2. Add the GitHub private key to ssh-agent:
#
#   ssh-aadd ~/.ssh/private_key_rsa
#
# 3. (On a MAC, need add to keychain)

- name: Update Code from Git remote repository (or multiple)
  git:
    repo: "{{ git_repo.repo }}"
    dest: "{{ remote.dir }}/{{ git_repo.dir }}"
    accept_hostkey: yes
    force: yes
    version: "{{ git_repo.version }}"
  loop: "{{ git_remote_repository | git_repo_list }}"
  loop_control:
    loop_var: git_repo
